<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Chat hỏi bói</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    {% include 'navbar.html' %}

    <div class="chat-container">
        <div class="chat-history" id="chat-history">
            {% for msg in chat_history %}
                <div class="message {{ msg.role }}">{{ msg.message }}</div>
            {% endfor %}
        </div>
        <div class="chat-input">
            <input type="text" id="message-input" placeholder="Nhập câu hỏi...">
            <button onclick="sendMessage()">Gửi</button>
        </div>
    </div>

<script>
function scrollBottom() {
    const container = document.getElementById("chat-history");
    container.scrollTop = container.scrollHeight;
}

function addMessage(text, role) {
    const history = document.getElementById("chat-history");
    const div = document.createElement("div");
    div.className = "message " + role + " new";
    div.textContent = text;
    history.appendChild(div);
    scrollBottom();
}

function sendMessage() {
    const input = document.getElementById("message-input");
    const message = input.value.trim();
    if(!message) return;
    input.value = "";
    input.focus();
    addMessage(message, "user");

    fetch("/chat/send", {
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({message})
    })
    .then(res=>res.json())
    .then(data=>{
        addMessage(data.reply, "bot");
    });
}

const inputField = document.getElementById("message-input");
inputField.addEventListener("keydown", function(event) {
    if(event.key === "Enter") {
        event.preventDefault();
        sendMessage();
    }
});

scrollBottom();
inputField.focus();
</script>
</body>
</html>
